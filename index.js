const express = require("express");
const https = require("https");
const config = require("config");

const app = express();

require("express-async-errors");
const connectDB = require("./startup/db");
require("./startup/routes")(app);

const httpsPORT = 3443;
const sslServer = https.createServer(
  {
    key: Buffer.from(config.get("sslKey"), "base64").toString("ascii"),
    cert: Buffer.from(
      "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURXVENDQWtFQ0ZCMXNzZnRoZ09oQ2V0SlozcVg2azRubXN4R3pNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1Ha3gKQ3pBSkJnTlZCQVlUQWtsT01STXdFUVlEVlFRSURBcFRiMjFsTFZOMFlYUmxNUm93R0FZRFZRUUtEQkZKY25KcApaMkYwYVc5dUlGTjVjM1JsYlRFcE1DY0dDU3FHU0liM0RRRUpBUllhWm1GcGMyRnNNVGt3TlRJMU9FQnpkQzVxCmJXa3VZV011YVc0d0hoY05Nak13TWpJMU1UQTFOelF6V2hjTk1qUXdNakkxTVRBMU56UXpXakJwTVFzd0NRWUQKVlFRR0V3SkpUakVUTUJFR0ExVUVDQXdLVTI5dFpTMVRkR0YwWlRFYU1CZ0dBMVVFQ2d3UlNYSnlhV2RoZEdsdgpiaUJUZVhOMFpXMHhLVEFuQmdrcWhraUc5dzBCQ1FFV0dtWmhhWE5oYkRFNU1EVXlOVGhBYzNRdWFtMXBMbUZqCkxtbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXk4VitxanB6cHFCdGVxMTMKenRxOTY4aCtqT0R6d0xJelo2ZHJkRVRVYWNIcXZ5QWs0ZFlUZk0wYW4zWTFmVDZzdlB2V1NNYnVnbkY5akpldApkU21RYXVjWDhpcVNHWk13Y01NaXhuUDBTQ3BTc0krL1ZpRlNFdm5CL1VLSzNyVVRhNGRBbFdGRDhZU0pkeGRGCjFqTGQxSitQVWF0UFdvWHF6R1dBektxUW0xUDNMZnYvSjlQZm5Ybm5zeG1JMTk3SGh1RXdwWlVSbnAxTWY1cGUKYUJNY2xDUGlNZGRKZzJCMDdxNHRWSjJjMlZlcitVc1Z1MXRKd1Z5UjZZR0dhS3owOCs5YUZtR0JDUDlBanQrZAppbUF4VFUxZFRMQVRsSGZ6em9zeUlWS3hvWGpVRGlWRG1JN01TRmQ2OWxhalJhaGtZK2hTWE1ObUlVaUhYTWtPCk1YT21Ld0lEQVFBQk1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ1dBcW1HTy83NWhHaWxsUXhqL2RyVzcvSkMKcDR1aG9OUUJ1YVNLMFNZVTlRWnNnUjlPZ01zRmxJZzNqTEZkY05pVjB0WDZJSUxYM1FFbmFGbzBYWURCSUk0SApOR3R1VW5KaDNzRDZyVU9uMU1yNUFEYk1XZmtJaWtkNkt6NmtVMHNsZzhqTnZBYUlBWUlDM1ZEYTA0eG4xek5HCmZ4Vmk4Mk93NnVIdVI0MzFuN3JLaEJxYldOb0YxMGovYnIyeDV2MHNOK0QwL1Y5NEJ4a2g1bmt2Tk9qRU53L2MKOTY2L0duWTh3eHcrUHdsaUoydHNTMzdnZG9BdUtnTDBtTU5TaEdXRFI2ZmJQVU94MFJRaC8rcTBEWGFHWnEvLwpnWWZVMVdaOCtaaVc1d1JXMnYydWtNbmVka0NZaWk3b3I3YzdLd3M5QXhmNmZVV1JaRGFXUXI5aEFkaDQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==",
      "base64"
    ).toString("ascii"),
  },
  app
);

connectDB().then(() => {
  sslServer.listen(httpsPORT);
  app.listen(process.env.PORT || 5000, () => console.log(`Server Active`));
});
